---
- name: Installing Elastic GPG Keys
  rpm_key: state=present key=http://packages.elasticsearch.org/GPG-KEY-elasticsearch
  tags:
    - elastic

- name: Installing Elastic repository file
  template: src=elasticsearch.repo.j2 dest=/etc/yum.repos.d/elasticsearch.repo
  tags:
    - elastic

- name: Install Elastic packages
  yum: name={{ item }} state=latest
  with_items:
    - elasticsearch
    - java
  tags:
    - elastic

- name: Create Elastic directories
  file: dest={{ item }} owner=elasticsearch group=elasticsearch state=directory recurse=yes
  with_items:
    - /var/data/elasticsearch
    - /var/log/elasticsearch
  tags:
    - elastic

- name: Copy Elastic configuration file
  template: src=elasticsearch.yml.j2 dest=/etc/elasticsearch/elasticsearch.yml
  notify:
    - Restart Elastic

- name: Start Elastic service
  service: name=elasticsearch enabled=yes state=started
  tags:
    - elastic

- name: Setting up firewalld for Elastic
  firewalld: port=9200 permanent=true immediate=true state=enabled zone=public
  when: env_name == 'development'